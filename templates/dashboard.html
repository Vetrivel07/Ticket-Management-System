{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<div class="page-header">
  <h2 class="page-title">{{ user[1].capitalize() }} Dashboard</h2>
</div>
<div class="page-body">

    <p><strong>Username:</strong> {{ user[1] }}</p>
    <p><strong>Email:</strong> {{ user[2] }}</p>

    <p><strong>First Name:</strong> {{ user[4] }}</p>
    <p><strong>Last Name:</strong> {{ user[5] }}</p>
    <p><strong>Date of Birth:</strong> {{ user[6] }}</p>

    <p><strong>Address:</strong>
    {{ user[7] }}
    {% if user[8] %}, {{ user[8] }}{% endif %},
    {{ user[9] }}, {{ user[10] }} {{ user[11] }}
    </p>

    <p><strong>Phone:</strong> {{ user[12] }}</p>
    <p><strong>Profession:</strong> {{ user[13] }}</p>
    <p><strong>Organization:</strong> {{ user[14] }}</p>

    <p><strong>Role:</strong> {{ user[3] }}</p>


    <!-- Account Management -->
    <h3>Account Management</h3>
    <a href="{{ url_for('edit_account') }}">
        <button>Edit Account</button>
    </a>
    <button type="button" id="openDeactivateModal" style="background-color:#dc3545;color:white;">
        Deactivate Account
    </button>


    <hr>

       {# ---------------- Deactivate Modal ---------------- #}
        <div id="deactivateModal" class="modal" aria-hidden="true">
            <div class="modal-backdrop" id="deactivateBackdrop"></div>

            <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="deactivateTitle">
            <div class="modal-head">
                <h3 id="deactivateTitle">Deactivate Account</h3>
                <button type="button" class="modal-close" id="closeDeactivateModal">Ã—</button>
            </div>

            <div class="modal-body">
                <p class="muted">Enter your username and password to confirm deactivation.</p>

                {% if deactivate_error %}
                <p class="error" style="margin-top:10px;">{{ deactivate_error }}</p>
                {% endif %}

                <form method="POST" action="{{ url_for('delete_account') }}" id="deactivateForm">
                <label>Username</label>
                <input type="text" name="username" value="{{ user[1] }}" required>

                <label>Password</label>
                <input type="password" name="password" required>

                <div class="form-actions">
                    <button type="submit" style="background-color:#dc3545;color:white;">Deactivate</button>
                    <button type="button" id="cancelDeactivate">Cancel</button>
                </div>
                </form>
            </div>
            </div>
        </div>

    <!-- Ticket List -->
    {% if tickets %}
        <h3>Your Tickets:</h3>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Description</th>
                        {% if user[3] == 'responder' %}
                            <th>Posted By</th>
                        {% endif %}
                        <th>Status</th>
                        <th>Created At</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in tickets %}
                    <tr>
                        <td>{{ t[0] }}</td>
                        <td>{{ t[1] }}</td>
                        <td>{{ t[2] }}</td>
                        {% if user[3] == 'responder' %}
                            <td>{{ t[3] }}</td>
                        {% endif %}
                        <td>
                            {% set status = t[4 if user[3] == 'responder' else 3] %}
                            {{ 'Completed' if status == 'done' else ('Declined' if status == 'declined' else status.capitalize()) }}
                        </td>
                        <td>{{ t[5 if user[3] == 'responder' else 4] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No ticket activity yet.</p>
    {% endif %}
</div>
{# auto-open flag for JS #}
<input type="hidden" id="deactivateHasError" value="{% if deactivate_error %}1{% else %}0{% endif %}">

{% endblock %}
